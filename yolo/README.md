# YCtrain_aug3 è¨“ç·´ç’°å¢ƒèªªæ˜æ–‡ä»¶

## ğŸ“‹ å°ˆæ¡ˆæ¦‚è¿°
**è¨“ç·´å¯¦é©—åç¨±**: YCtrain_aug3  
**ä»»å‹™é¡å‹**: ä¸»å‹•è„ˆç“£è†œæª¢æ¸¬ (Aortic Valve Detection)  
**è¨“ç·´æ—¥æœŸ**: 2025å¹´ï¼ˆæ ¹æ“š args.yaml é…ç½®ï¼‰

---

## ğŸ’» ä½œæ¥­ç³»çµ±ç’°å¢ƒ

### ç³»çµ±è³‡è¨Š
- **ä½œæ¥­ç³»çµ±**: Ubuntu 24.04.3 LTS (Noble Numbat)
- **æ ¸å¿ƒç‰ˆæœ¬**: Linux 6.14.0-35-generic
- **æ¶æ§‹**: x86_64 (64-bit)
- **æ¡Œé¢ç’°å¢ƒ**: å·¥ä½œç«™ç’°å¢ƒ

### ç¡¬é«”é…ç½®
- **GPU**: NVIDIA GeForce RTX 5090
  - VRAM: 32607 MiB (~32 GB)
  - CUDA Driver: 570.195.03
  - CUDA Version: 12.8
- **é‹ç®—èƒ½åŠ›**: æ”¯æ´ CUDA 12.8 + cuDNN 9.10

---

## ğŸ ç¨‹å¼èªè¨€èˆ‡ç’°å¢ƒ

### Python ç’°å¢ƒ
- **Python ç‰ˆæœ¬**: 3.13.9
- **ç’°å¢ƒç®¡ç†**: Conda (Miniconda3)
- **Conda ç’°å¢ƒåç¨±**: AICUP
- **ç’°å¢ƒè·¯å¾‘**: `/home/yucheng/miniconda3`

---

## ğŸ“¦ ä¸»è¦å¥—ä»¶èˆ‡å‡½å¼åº«

### 1. æ·±åº¦å­¸ç¿’æ¡†æ¶
#### PyTorch ç”Ÿæ…‹ç³»çµ±
- **PyTorch**: 2.10.0.dev20251106+cu128 (CUDA 12.8 é–‹ç™¼ç‰ˆ)
- **TorchVision**: 0.25.0.dev20251106+cu128
- **TorchAudio**: 2.10.0.dev20251106+cu128

**ç”¨é€”**:
- æ ¸å¿ƒæ·±åº¦å­¸ç¿’æ¡†æ¶
- æä¾›è‡ªå‹•å¾®åˆ†ã€GPU åŠ é€Ÿé‹ç®—
- æ”¯æ´æœ€æ–° CUDA 12.8 æœ€ä½³åŒ–

#### CUDA ç›¸é—œå‡½å¼åº«
è‡ªå‹•éš¨ PyTorch å®‰è£çš„ NVIDIA å¥—ä»¶ï¼š
- `nvidia-cublas-cu12==12.8.4.1` - çŸ©é™£é‹ç®—åŠ é€Ÿ
- `nvidia-cudnn-cu12==9.10.2.21` - æ·±åº¦ç¥ç¶“ç¶²è·¯åŠ é€Ÿ
- `nvidia-cuda-nvrtc-cu12==12.8.93` - å³æ™‚ç·¨è­¯
- `nvidia-cufft-cu12==11.3.3.83` - å¿«é€Ÿå‚…ç«‹è‘‰è½‰æ›
- `nvidia-nccl-cu12==2.27.5` - å¤š GPU é€šè¨Š
- `pytorch-triton==3.5.1` - GPU æ ¸å¿ƒå„ªåŒ–

### 2. YOLO ç‰©ä»¶æª¢æ¸¬æ¡†æ¶
- **Ultralytics YOLO**: >=8.3.0 (æ¨è–¦ 8.3.229+)

**ç”¨é€”**:
- æä¾› YOLOv12 ç³»åˆ—æ¨¡å‹æ¶æ§‹
- æ•´åˆè¨“ç·´ã€é©—è­‰ã€æ¨è«–ç®¡ç·š
- æ”¯æ´å¤šç¨®è³‡æ–™å¢å¼·ç­–ç•¥
- è‡ªå‹•åŒ–è¶…åƒæ•¸èª¿æ•´

### 3. é›»è…¦è¦–è¦ºèˆ‡å½±åƒè™•ç†
- **OpenCV**: opencv-python >=4.8.0
- **Pillow**: 12.0.0

**ç”¨é€”**:
- å½±åƒè®€å–ã€é è™•ç†
- å¹¾ä½•è®Šæ›ã€è‰²å½©ç©ºé–“è½‰æ›
- å½±åƒæ¨™è¨»èˆ‡è¦–è¦ºåŒ–

### 4. æ•¸å€¼é‹ç®—èˆ‡è³‡æ–™è™•ç†
- **NumPy**: 2.3.4 - å¤šç¶­é™£åˆ—é‹ç®—
- **Pandas**: >=2.0.0 - è³‡æ–™æ¡†è™•ç†èˆ‡åˆ†æ
- **SciPy**: >=1.11.0 - ç§‘å­¸è¨ˆç®—å‡½å¼åº«

### 5. è¦–è¦ºåŒ–å·¥å…·
- **Matplotlib**: >=3.7.0 - ç¹ªåœ–èˆ‡åœ–è¡¨
- **Seaborn**: >=0.12.0 - çµ±è¨ˆè¦–è¦ºåŒ–

### 6. é…ç½®èˆ‡å·¥å…·
- **PyYAML**: 6.0.3 - YAML é…ç½®æª”è§£æ
- **tqdm**: 4.67.1 - é€²åº¦æ¢é¡¯ç¤º
- **fsspec**: æ–‡ä»¶ç³»çµ±æŠ½è±¡å±¤
- **huggingface-hub**: 0.36.0 - æ¨¡å‹æ¬Šé‡ä¸‹è¼‰

### 7. æ©Ÿå™¨å­¸ç¿’è¼”åŠ©å·¥å…·
- **scikit-learn**: >=1.3.0 - è©•ä¼°æŒ‡æ¨™ã€è³‡æ–™åˆ†å‰²
- **scikit-image**: >=0.21.0 - å½±åƒè™•ç†æ¼”ç®—æ³•

### 8. æ¨¡å‹å„ªåŒ–èˆ‡éƒ¨ç½² (å¯é¸)
- **ONNX**: >=1.15.0 - æ¨¡å‹æ ¼å¼è½‰æ›
- **onnxruntime-gpu**: >=1.16.0 - ONNX æ¨è«–åŠ é€Ÿ

---

## ğŸ¯ é è¨“ç·´æ¨¡å‹ä½¿ç”¨

### ä¸»æ¨¡å‹: YOLOv12-X (yolo12x.pt)

#### æ¨¡å‹è¦æ ¼
- **æ¨¡å‹åç¨±**: YOLOv12-X (Extra Large)
- **æ¨¡å‹æª”æ¡ˆ**: `yolo12x.pt`
- **ä¾†æº**: Ultralytics å®˜æ–¹é è¨“ç·´æ¬Šé‡
- **é è¨“ç·´è³‡æ–™é›†**: COCO Dataset (80 é¡é€šç”¨ç‰©ä»¶)

#### ä½¿ç”¨æ–¹å¼
```python
from ultralytics import YOLO

# è¼‰å…¥é è¨“ç·´æ¨¡å‹
model = YOLO('yolo12x.pt')

# åœ¨è‡ªè¨‚è³‡æ–™é›†ä¸Šå¾®èª¿
model.train(
    data='datasets/aortic_valve.yaml',
    epochs=500,
    batch=8,
    imgsz=512,
    pretrained=True  # ä½¿ç”¨é è¨“ç·´æ¬Šé‡åˆå§‹åŒ–
)
```

#### å°æ¨¡å‹æ•ˆèƒ½çš„è²¢ç»

##### 1. **ç‰¹å¾µæå–èƒ½åŠ›é·ç§»**
- **è²¢ç»**: é è¨“ç·´æ¨¡å‹å·²å­¸ç¿’é€šç”¨ç‰©ä»¶çš„ä½éšç‰¹å¾µï¼ˆé‚Šç·£ã€ç´‹ç†ã€å½¢ç‹€ï¼‰
- **æ•ˆæœ**: 
  - åŠ å¿«æ”¶æ–‚é€Ÿåº¦ï¼ˆæ¸›å°‘ 30-50% è¨“ç·´æ™‚é–“ï¼‰
  - é™ä½éæ“¬åˆé¢¨éšª
  - å°æ¨£æœ¬å ´æ™¯ä¸‹è¡¨ç¾æ›´ç©©å®š

##### 2. **æ¶æ§‹å„ªå‹¢**
- **æ¨¡å‹å¤§å°**: X (Extra Large) ç‰ˆæœ¬
- **åƒæ•¸é‡**: ç´„ 60-80M åƒæ•¸
- **ç‰¹é»**:
  - æ›´æ·±çš„ç¶²è·¯å±¤æ•¸ï¼Œæ•æ‰è¤‡é›œç‰¹å¾µ
  - æ›´å¯¬çš„é€šé“æ•¸ï¼Œå¢å¼·è¡¨é”èƒ½åŠ›
  - é©åˆé«˜è§£æåº¦å½±åƒ (512x512)

##### 3. **å¤šå°ºåº¦æª¢æ¸¬èƒ½åŠ›**
- **P3-P5 ç‰¹å¾µé‡‘å­—å¡”**: æª¢æ¸¬ä¸åŒå°ºåº¦çš„ä¸»å‹•è„ˆç“£è†œ
- **é·ç§»å„ªå‹¢**: 
  - COCO é è¨“ç·´æ¶µè“‹å¤§å°ç‰©ä»¶
  - å°é†«å­¸å½±åƒä¸­çš„å°ºåº¦è®ŠåŒ–æ›´é­¯æ£’

##### 4. **åˆå§‹æ¬Šé‡å“è³ª**
- **Batch Normalization çµ±è¨ˆ**: é è¨“ç·´çš„ BN å±¤å·²æ”¶æ–‚
- **å·ç©æ ¸åˆå§‹åŒ–**: é¿å…éš¨æ©Ÿåˆå§‹åŒ–çš„ä¸ç©©å®šæ€§
- **å„ªåŒ–å™¨ç‹€æ…‹**: warmup éšæ®µæ›´å¹³æ»‘

##### 5. **è³‡æ–™å¢å¼·ç›¸å®¹æ€§**
- é è¨“ç·´æ¨¡å‹å°ä»¥ä¸‹å¢å¼·ç­–ç•¥æœ‰è‰¯å¥½é©æ‡‰ï¼š
  - å¹¾ä½•è®Šæ› (æ—‹è½‰ 10Â°, å¹³ç§» 10%, ç¸®æ”¾ 25%)
  - MixUp (0.1) - æ··åˆè¨“ç·´æ¨£æœ¬
  - Random Erasing (0.2) - æ¨¡æ“¬é®æ“‹

---

## âš™ï¸ è¨“ç·´é…ç½®ç´°ç¯€ (YCtrain_aug3)

### åŸºæœ¬è¨­å®š
```yaml
æ¨¡å‹: yolo12x.pt (é è¨“ç·´)
è³‡æ–™é›†: datasets/aortic_valve.yaml
è¨“ç·´è¼ªæ•¸: 500 epochs
æ‰¹æ¬¡å¤§å°: 8
å½±åƒå°ºå¯¸: 512x512
è£ç½®: GPU 0 (RTX 5090)
å·¥ä½œåŸ·è¡Œç·’: 16
```

### å„ªåŒ–å™¨é…ç½®
```yaml
å„ªåŒ–å™¨: SGD (auto)
åˆå§‹å­¸ç¿’ç‡: 0.01
æœ€çµ‚å­¸ç¿’ç‡: 0.01
å‹•é‡: 0.937
æ¬Šé‡è¡°æ¸›: 0.0005
Warmup: 3 epochs
AMP (æ··åˆç²¾åº¦): å•Ÿç”¨
```

### æå¤±å‡½æ•¸æ¬Šé‡
```yaml
Box Loss: 7.5 (å®šä½æå¤±)
Class Loss: 0.5 (åˆ†é¡æå¤±)
DFL Loss: 1.5 (åˆ†ä½ˆç„¦é»æå¤±)
```

### è³‡æ–™å¢å¼·ç­–ç•¥
#### å¹¾ä½•å¢å¼·
- **æ—‹è½‰**: Â±10Â° (é©æ‡‰ä¸åŒæƒæè§’åº¦)
- **å¹³ç§»**: Â±10% (ä½ç§»å®¹å¿)
- **ç¸®æ”¾**: Â±25% (å°ºåº¦è®ŠåŒ–)
- **æ°´å¹³ç¿»è½‰**: 50% (å·¦å³å¿ƒå®¤å°ç¨±)
- **å‚ç›´ç¿»è½‰**: 0% (é¿å…è§£å‰–å­¸ä¸åˆç†)
- **å‰ªåˆ‡**: 0Â° (CT å½±åƒç„¡éœ€å‰ªåˆ‡)

#### åƒç´ ç´šå¢å¼·
- **HSV èª¿æ•´**: å…¨éƒ¨é—œé–‰ (ç°éš CT å½±åƒ)
- **MixUp**: 0.1 (è¼•åº¦æ¨£æœ¬æ··åˆ)
- **Random Erasing**: 0.2 (æ¨¡æ“¬é®æ“‹èˆ‡å½å½±)
- **Mosaic**: 0 (é—œé–‰ï¼ŒCT æ‹¼æ¥ä¸è‡ªç„¶)

#### é€²éšå¢å¼·
- **Multi-scale Training**: å•Ÿç”¨ (æå‡å°ºåº¦æ³›åŒ–)
- **Auto Augment**: RandAugment
- **Close Mosaic**: æœ€å¾Œ 10 epochs é—œé–‰æ‰€æœ‰å¢å¼·

### è¨“ç·´ç­–ç•¥
- **Early Stopping**: 50 epochs ç„¡æ”¹å–„åœæ­¢
- **æª¢æŸ¥é»å„²å­˜**: æ¯ 10 epochs å„²å­˜
- **å¿«å–**: å•Ÿç”¨ (åŠ é€Ÿè³‡æ–™è®€å–)
- **æ··åˆç²¾åº¦**: å•Ÿç”¨ (æ¸›å°‘è¨˜æ†¶é«”ä½”ç”¨)

---

## ğŸ“Š è¨“ç·´çµæœ

### æ¨¡å‹æ¬Šé‡
è¨“ç·´ç”¢ç”Ÿçš„æ¬Šé‡æª”æ¡ˆï¼š
- `best.pt` - é©—è­‰é›†æœ€ä½³æ¨¡å‹
- `last.pt` - æœ€çµ‚è¨“ç·´æ¨¡å‹
- `epoch{N}.pt` - æ¯ 10 è¼ªå„²å­˜çš„æª¢æŸ¥é»

### è©•ä¼°æŒ‡æ¨™
å¯è¦–åŒ–æª”æ¡ˆï¼š
- `BoxF1_curve.png` - F1 åˆ†æ•¸æ›²ç·š
- `BoxPR_curve.png` - Precision-Recall æ›²ç·š
- `confusion_matrix.png` - æ··æ·†çŸ©é™£
- `results.csv` - è©³ç´°è¨“ç·´æ—¥èªŒ

---

## ğŸš€ ç’°å¢ƒå®‰è£æŒ‡ä»¤

### æ–¹æ³• 1: ä½¿ç”¨ requirements.txt
```bash
# å‰µå»º conda ç’°å¢ƒ
conda create -n AICUP python=3.13 -y
conda activate AICUP

# å®‰è£ PyTorch (CUDA 12.8)
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu128

# å®‰è£å…¶ä»–å¥—ä»¶
pip install -r requirements.txt
```

### æ–¹æ³• 2: æ‰‹å‹•å®‰è£é—œéµå¥—ä»¶
```bash
conda activate AICUP

# æ ¸å¿ƒæ¡†æ¶
pip install torch==2.10.0.dev20251106+cu128 --index-url https://download.pytorch.org/whl/cu128
pip install ultralytics>=8.3.0

# è¦–è¦ºèˆ‡è³‡æ–™è™•ç†
pip install opencv-python opencv-contrib-python
pip install numpy pandas scipy matplotlib seaborn
pip install Pillow PyYAML tqdm

# æ©Ÿå™¨å­¸ç¿’å·¥å…·
pip install scikit-learn scikit-image
```

### é©—è­‰å®‰è£
```bash
python -c "import torch; print(f'PyTorch: {torch.__version__}')"
python -c "import torch; print(f'CUDA: {torch.cuda.is_available()}')"
python -c "from ultralytics import YOLO; print('Ultralytics OK')"
```

---

## ğŸ“ é‡ç¾è¨“ç·´

### å®Œæ•´è¨“ç·´æŒ‡ä»¤
```bash
cd /home/yucheng/Desktop/AICUP/hailey

python train_aortic_valve_local.py \
  --img-root <å½±åƒè·¯å¾‘> \
  --lbl-root <æ¨™ç±¤è·¯å¾‘> \
  --output-dir ./datasets \
  --model-size x \
  --epochs 500 \
  --batch-size 8 \
  --img-size 512 \
  --device 0 \
  --patience 50 \
  --save-period 10 \
  --cache \
  --workers 16 \
  --project ./runs/detect \
  --name YCtrain_aug3
```

### ä½¿ç”¨é è¨“ç·´æ¨¡å‹æ¨è«–
```bash
python -c "
from ultralytics import YOLO
model = YOLO('./runs/detect/YCtrain_aug3/weights/best.pt')
results = model.predict('test_image.png', conf=0.25)
results[0].show()
"
```

---

## ğŸ” é—œéµæŠ€è¡“ç¸½çµ

### é è¨“ç·´é·ç§»å­¸ç¿’çš„æ•ˆç›Š
1. **æ”¶æ–‚é€Ÿåº¦**: åŠ å¿« 40%+
2. **æ³›åŒ–èƒ½åŠ›**: æ¸›å°‘éæ“¬åˆ
3. **å°è³‡æ–™é›†å‹å–„**: åƒ…éœ€æ•¸åƒå¼µæ¨™è¨»å½±åƒ
4. **ç‰¹å¾µè¤‡ç”¨**: COCO çš„é€šç”¨ç‰¹å¾µé©ç”¨æ–¼é†«å­¸å½±åƒ

### YOLOv12-X å„ªå‹¢
- æœ€å¤§æ¨¡å‹å®¹é‡ï¼Œé©åˆè¤‡é›œé†«å­¸å½±åƒ
- 512x512 é«˜è§£æåº¦ä¿ç•™ç´°ç¯€
- å–®éšæ®µæª¢æ¸¬å™¨ï¼Œæ¨è«–é€Ÿåº¦å¿«

### è³‡æ–™å¢å¼·ç­–ç•¥
- é‡å° CT å½±åƒç‰¹æ€§è¨­è¨ˆï¼ˆç°éšã€è§£å‰–å­¸é™åˆ¶ï¼‰
- å¹³è¡¡å¹¾ä½•è®Šæ›èˆ‡åƒç´ æ“¾å‹•
- é¿å…ä¸åˆç†çš„å¢å¼·ï¼ˆå¦‚å‚ç›´ç¿»è½‰ã€Mosaicï¼‰

---

## ğŸ“§ è¯çµ¡è³‡è¨Š
**å°ˆæ¡ˆè·¯å¾‘**: `/home/yucheng/Desktop/AICUP/hailey`  
**è¨“ç·´è¼¸å‡º**: `./runs/detect/YCtrain_aug3`  
**ç’°å¢ƒåç¨±**: AICUP (Conda)

---

**æ–‡ä»¶ç”Ÿæˆæ—¥æœŸ**: 2025å¹´12æœˆ4æ—¥
